【要件定義書】TechMight 認証・ユーザー登録フロー大規模改修（既存機能温存版）
1. プロジェクト概要
本プロジェクトは、プログラミング学習者支援アプリ「TechMight」のユーザー認証および登録フローを改修するものである。現在のメールアドレスベースの登録フローを一時的に無効化し、GitHub認証を主軸とし、LINE連携を必須とする新しいフローを実装する。

これにより、ユーザー登録のハードルを下げ、将来的にGitHubリポジトリ分析とLINEによるパーソナライズされた情報提供を実現するための基盤を構築することを目的とする。

2. 基本方針：既存機能の温存
最重要原則として、既存のメールアドレス認証関連のコードは削除しないこと。 機能的には無効化するが、将来的に再度有効化できるよう、関連するコンポーネントの呼び出しやUI部分をコメントアウトすることで対応する。ファイルの削除や、ファイル内のコードの大部分を削除するような変更は行わない。

3. 改修スコープ（今回実施すること）
既存のメールアドレスとパスワードによる認証・登録機能の一時的な無効化。

Supabase Authを利用したGitHub認証によるログイン・新規登録機能の実装。

GitHubでの初回ログイン後、LINEログインによるアカウント連携を必須とするフローの実装。

既存のSupabase profilesテーブルに、LINEから取得したユーザー情報を保存するカラムを追加し、データを格納する。

フロントエンドのUIを、GitHubログインを前提としたデザインに変更する。

スコープ外（今回は実施しないこと）
GitHubリポジトリの分析機能。

LINEへのメッセージ通知機能の実装（今回はデータ格納まで）。

ユーザーによる退会・データ削除機能。

4. 機能要件詳細
4.1. ユーザー認証フローの変更
【AS-IS】（現状）
app/page.js および app/login-form.tsx にて、メールアドレスとパスワード（またはマジックリンク）によるログイン・新規登録フォームを提供している。

認証が成功すると、/account ページにリダイレクトされる。

【TO-BE】（改修後）
ログインUIの変更:

app/page.js 内で LoginForm コンポーネントを動的にインポートし、表示している箇所をコメントアウトする。

コメントアウトした箇所の下に、新たに**「GitHubでログイン/登録」ボタンを1つ設置**する。

このボタンをクリックすると、Supabase AuthのGitHubプロバイダー認証プロセスが開始されるように実装する。

app/login-form.tsx ファイル自体は変更・削除しないこと。

認証コールバック処理の変更:

app/auth/callback/route.ts の処理を、GitHub認証に対応するように追記・変更する。既存のメール認証用のコードは、条件分岐などで残すか、判別しやすいようにコメントを付与しておくこと。

GitHub認証に成功し、セッションが確立されたら、profilesテーブルにユーザー情報が存在するか確認する。

情報が存在する場合（再ログインユーザー）: /account ページへリダイレクトする。

情報が存在しない場合（新規登録ユーザー）: LINE連携を促すための中間ページ（例：/link-line）へリダイレクトする。

4.2. LINE連携機能の実装（新規）
フロー
ユーザーがGitHubで初めてログインすると、LINE連携を促す画面（例：/link-line）に強制的にリダイレクトされる。

この画面には「LINEと連携する」ボタンのみを配置する。

ボタンをクリックすると、LINEログインの認証フローを開始する。

注意: LINE Developersで新しいチャネルを作成し、LINEログインの設定を行う必要がある。取得したチャネルIDとチャネルシークレットは、環境変数として設定すること。

LINEの認証・認可が完了したら、コールバック処理で以下の情報を取得する。

LINE User ID

表示名

プロフィール画像URL（取得できれば）

取得したLINE情報を、GitHub認証時に作成されたprofilesテーブルの該当ユーザーのレコードに追記・更新する。

データの更新が完了したら、正規の /account ページへリダイレクトする。

4.3. アカウントページ (/account) の改修
【AS-IS】（現状）
app/account/page.tsx は、プロフィール更新フォーム (account-form.tsx) とパスワード更新フォーム (password-form.tsx) を表示している。

【TO-BE】（改修後）
app/account/page.tsx ファイル内で、PasswordForm コンポーネントをインポートし、呼び出している箇所をコメントアウトする。app/account/password-form.tsx ファイル自体は削除しないこと。

account-form.tsx を改修し、主にGitHubとLINEから取得した情報を表示する画面に変更する。（例：GitHubユーザー名、LINE表示名などを表示）。

サインアウトボタン (/auth/signout) は引き続き機能させる。

5. 非機能要件
5.1. データベース設計の変更
Supabaseのprofilesテーブルに、LINE連携で取得する情報を格納するためのカラムを追加する。

database.types.ts ファイルもこの変更に合わせて更新すること。

profilesテーブルへの追加カラム案:
| カラム名 | 型 | 説明 | Null許容 |
| :--- | :--- | :--- | :--- |
| line_user_id | text | LINEから取得するユーザーID。一意であるべき。 | false（連携必須のため） |
| line_display_name | text | LINEの表示名 | true |
| line_avatar_url | text | LINEのプロフィール画像URL | true |

5.2. 使用技術・ライブラリ
フレームワーク: Next.js (App Router)

バックエンド/DB: Supabase

認証: Supabase Auth (GitHub, LINEプロバイダー)

フロントエンド: React, TypeScript

5.3. プライバシーポリシー
フッターなどにプライバシーポリシーへのリンクを設置する。

内容は、GitHubおよびLINEから取得する情報（ユーザー名、メールアドレス、LINE User IDなど）とその利用目的（本人確認、通知のため）を明記した、一般的なものとする。

6. 参考資料（既存コード）
この要件定義は、以下の提供されたファイルを前提としています。

app/auth/callback/route.ts

app/auth/signout/route.js

app/account/page.tsx

app/account/account-form.tsx

app/database.types.ts

app/page.js

app/login-form.tsx

app/account/password-form.tsx